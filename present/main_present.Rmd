---
title: "High Dimensional Feature Selection with Interactions for Time-to-Event Outcome"
subtitle: ""  
author: 
  - "Lin Yu"
  - 
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    self_contained: true
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
	eval = FALSE,
	fig.height = 3.5,
	fig.retina = 3,
	fig.width = 9,
	message = FALSE,
	warning = FALSE,
	cache = FALSE,
	hiline = TRUE,
	include = FALSE,
	out.width = "100%"
)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#3C989E",        # blue
  secondary_color = "#B2DFDB",      # sea green
  header_font_google = google_font("Lo"),
  text_font_google = google_font("DM Serif Display"),
  header_h1_font_size = "2.75rem",
  header_h2_font_size = "2rem",
  header_h3_font_size = "1.25rem",
  text_font_size = "1rem",
  title_slide_background_color = "#B2DFDB"
  #,
  #title_slide_background_image = 'background_png.png',
  
 
)


```


```{r xaringanExtra-search, echo=FALSE}
xaringanExtra::use_search(show_icon = TRUE)
xaringanExtra::style_search(match_background = "skyblue")
xaringanExtra::use_clipboard()
xaringanExtra::use_scribble()
xaringanExtra::use_tile_view() ## press O 
xaringanExtra::use_progress_bar(color = "#3C989E", location = "bottom")
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         
  mute_unhighlighted_code = TRUE  
)
```

```{r xaringan-fit-screen, echo=FALSE}
xaringanExtra::use_fit_screen()
```

# Background

### What is feature selection?   

> A process to select **a subset of features** from obtained data that are **useful** for model building

### Feature selection is especially useful when:
> Have data set with high dimensional feature space: number of features are relatively large compares to number of samples/"events" (e.g, genotyping data)

### Why feature selection?
.pull-left[
> **without feature selection:** 
model overfitting and generalizability problem; unstable estimates;  time/cost
]

.pull-right[
> **with feature selection:** 
remove noisy features,cost/time-effective; improve prediction performance; 
]

### Commonly used techniques:
> expert-based; statistics-based(for example, lasso,ridge)

---
<span style="color:black;font-weight:90;font-size:1.25rem"> 
However, **interaction effect is not considered** in these methods
</span>

<span style="color:black;font-weight:90;font-size:1.25rem"> 
**HDSI algorithm**: 1. interaction terms; 2. statistical significance in feature selection.

Related work by Rahi Jain and Ziqian Zhang: 

.pull-left[<img src="00related_work1.png" width="80%">]

.pull-right[<img src="00related_work2.png" width="80%">]

</span>           
---
class: center, middle 

<span style="color:black;font-weight:90;font-size:1.8rem"> 
Question:   Is HDSI Robust? Can it be used for different types of data? </span>

<span style="color:black;font-weight:90;font-size:1.8rem"> 
Objective: 
Extend HDSI for feature selection with **interactions** for **time-to-event data**
</span>

---
# Method Overview
> ### Step 1: Generate simulated time-to-event data

<br>
> ### Step 2: Prepare bootstrap sample sets

<br>

> ### Step 3: Apply Feature selection techniques to bootstrap samples

<br>
> ### Step 4: Evaluate feaature significance/ model performance and determine features


---
## Step 1: Simulate Time-to-Event Data
.pull-left[       
<img src="01survival_dat.png" style="width: 95%"/> 
]

.pull-right[       
- Dimension:  $nÂ·(p+2)$  
<br>     
 - n observations 
 - p features
 - outcome: survival time and status
]
--
<br>
.pull-left[       
> ### how to simulate features?

- Assumption: $X_p$ ~ normal distribution 
- pre-specified correlation matrix

]

.pull-right[       
>### how to simulate time & status?

  Assumptions:
  - Survival time ~ exp( $\lambda$ )
  - Censoring time ~ unif(0,b)
]

---
## Step 1: Simulate Time-to-Event Data (cont'd)
.pull-left[
###CDF of survival function of Cox model             

  $F(t|X) = 1 - S(t|Z) = 1 - e^{ H_0(t)*e^{\beta X}}$  
-  $F(t|Z)$: CDF of survival function 

- $S(t|Z)$: survival function

- $H_0(t)$: CDF of hazard function

- $X$: feature vector, $\beta$ is the coefficient vector
]
--
.pull-right[
###Nice properties of uniform(0,1)
- Property 1: $T|X$ ~ F implies $F(T|X)$ ~ Unif(0,1)

  - $F(T|X) =1 - e^{ H_0(T)*e^{\beta X}}$ ~Unif(0,1)

- Property 2: $U$ ~Unif(0,1), then $1-U$ ~ Unif(0,1)
  - $U = e^{ H_0(T)*e^{\beta X}}$ ~Unif(0,1)
  
  - $T = H_0^{-1}[-log(U)e^{(-\beta X)}]$
]  
--
.pull-left[
Step 1a)  
- features ~ normal
- $T = H_0^{-1}[-log(U)e^{(-\beta X)}]$     
- Censoring time ~ uniform
]
--
.pull-right[
Step 1b)
- time = $min$(T,Censoring time)
- status = $I$(T < Censoring time)
]

---
## Step 2: Generate Bootstrap Sets
> step 2a) Generate **One** Bootstrap Set

<br>
<img src="02boot1.png" width="31%" height="350">
<img src="02boot2.png" width="33%" height="350">
<img src="02boot3.png" width="35%" height="350">
---
## Step 2: Generate Bootstrap Sets

> step 2b) Generate **B** Bootstrap Set: [repeat Step 2a) B times]

<br>
<img src="02boot4.png">

---
## Step 3: Build Model & Select Features 

Step 3a) For the $j^{th}$ bootstrap set, we apply lasso/ridge to fit a model:

.pull-left[<img src="03model_dat.png" width="75%">
- for illustration purpose,
consider two features

- n observations]               


.pull-right[<img src="03model_out.png" width="80%">
$X_i: i^{th} \text{feature, } i \in \{ \text{1,2,3,...p,p+1,...}{p\choose 2}\}$

$\hat{\beta_i^j} \text{ :estimate of } X_i \text{ in the } j^{th} \text{ bootstrap set, } j \in \{ \text{1,2,3,...k}\}$

$C_i^j \text{ :C index of } X_i \text{ in the } j^{th} \text{ bootstrap set, }j \in \{ \text{1,2,3,...k}\}$
]


---

## Step 3: Build Model & Select Features
Step 3b) Repeat 3a) for all boostrap sets:

<img src="03model_out1.png" width="80%">

Step 3c) Pool results:        

$$\hat{\beta_i} = \sum_{j=1}^{k}\hat{\beta}_i^j/b_j$$

$$C_i =min(C_i^j) $$

$\beta_i$: pooled coefficient estimate of  $X_i$


$b_j$: the number of bootstrap sets containing $X_i$







  


  


  
  


